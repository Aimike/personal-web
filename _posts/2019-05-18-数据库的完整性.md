---
layout: post
title:  "数据库安全性"
date:   2019-05-17 13:51:01 +0800
categories: 数据库
tag: 数据库
---

{:toc}

# 第四章 数据库安全性

-   用户身份鉴别
-   存取控制
-   审计

## 4.1数据库安全性概述

数据库的安全性是指保护数据库以防止不合法使用所造成的数据泄露、更改或破坏。

### 4.1.1数据库不安全因素

对数据库安全性产生威胁的因素主要有以下几个方面：

1.  非授权用户对数据库的恶意存取和破坏
2.  数据库中重要或敏感的数据被泄露
3.  安全环境的脆弱性

### 4.1.2 安全标准简介

TCSEC/TDI中定义了数据库管理系统的设计和实现中需满足和用以进行安全性级别评估的标准，从4个方面来描述安全性级别划分的指标，即：

-   安全策略
-   责任
-   保证
-   文档

根据计算机系统对各项指标的支持情况，TCSEC/TDI将系统划分为4组7个等级，依次是
D、C(C1，C2)、B(B1,B2,B3)、A(A1)

**TCSER/TDI安全级别划分**

| 安全级别 | 定义                                        |
| ---- | ----------------------------------------- |
| A1   | 验证设计(vertified design)                    |
| B3   | 安全域(security domains)                     |
| B2   | 结构化保护(structural protection)              |
| B1   | 标记安全保护(labeled security protection)       |
| C2   | 受控的存取保护(controlled access protection)     |
| C1   | 自主安全保护(discretionary security protection) |
| D    | 最小保护(minimal protection)                  |

## 4.2数据库安全性控制

### 4.2.1用户身份鉴别

用户身份鉴别是数据库管理系统提供的最外层安全保护措施。每个用户在系统中都有一个用户标识。每个用户标识由用户名(user name)和用户标识号(UID)两部分组成。UID在系统的整个生命周期内是唯一的。系统内部记录着所有合法用户的标识，系统鉴别是指由系统提供一定的方式让用户标识自己的名字或身份。每次用户要求进入系统时，由系统进行核对，用过鉴定后才提供使用数据库管理系统的权限。

**常用的用户鉴别方法有以下几种：**

1.  静态口令鉴别
2.  动态口令鉴别
3.  生物特征鉴别
4.  智能卡鉴别

### 4.2.2存取控制

数据库安全最重要的一点就是确保只授权给有资格的用户访问数据库的权限，同时令所有未被授权的人员无法接近数据，这主要通过数据库系统的存取控制机制实现。

-   存取控制机制主要包括定义用户权限和合法权限检查两部分。

    1.  定义用户权限，并将用户权限登记到数据字典中
        用户对某一数据对象的操作权力称为权限。
    2.  合法权限检查
        每当用户发出存取数据库操作的请求后，数据库管理系统查找数据字典，根据安全规则进行合法权限检查，若用户的操作请求超出了定义的权限，系统将拒绝执行此操作。

-   自主存取控制

      定义:用户可以“自主”地决定将数据的存取权限授予何人，决定是否也将“授权”的权限授予别人，这样的存取控制是自主存取控制。

C2级的数据库管理系统支持自主存取控制（Discretionary Access Control,DAC）,B1级的数据库管理系统支持强制存取控制（Mandatory Access Control,MAC）,两者的区别如下：

1.  在**自主存取控制**方法中，用户对不同的数据库对象有不同的存取权限，不同的用户对同一对象也有不同的权限，而且用户还可将其拥有的存取权限转授给其他用户。因此自主存取控制非常灵活。
2.  在**强制存取控制**方法中，每一个数据库对象被标以一定的密级，每一个用户也被授予某一个级别的许可证。对于任意一个对象，只有具有合法许可证的用户才可以存取，强制存取控制因此相对比较严格。

### 4.2.3自主存取控制方法

SQL中的自主存取控制主要通过SQL的GRANT语句和REVOKE语句实现的。
<span style="color:#FF6666;">用户权限是</span>是由两个要素组成的：数据库对象和操作类型。定义一个用户的存取权限就是要定义这个用户可以在哪些数据库对象上进行哪些类型的操作。在数据库系统中，<span style="color:#FF6666;">定义存取权限称为授权</span>。

在非关系型数据库中，用户只能对数据进行操作，存取控制的数据库对象也仅限于数据本身。

在关系型数据库中，存取控制的对象不仅有数据本身（基本表中的数据、属性列上的数据），还有数据库模式（包括模式、基本表、视图和索引的创建等）。

**关系数据据系统中的存取权限**

| 对象类型  | 对象     | 操作类型                                                  |
| :---- | :----- | :---------------------------------------------------- |
| 数据库模式 | 模式     | CREATE SCHEMA                                         |
|       | 基本表    | CREATE TABLE,ALTER TABLE                              |
|       | 视图     | CREATE VIEW                                           |
|       | 索引     | CREATE INDEX                                          |
| 数据    | 基本表和视图 | SELECT,INSERT,UPDATE,DELETE,REFERENCES,ALL PRIVILEGES |
|       | 属性列    | SELECT,INSERT,UPDATE,REFERENCES,ALL PRIVILEGES        |

### 4.2.4授权：授予与收回

SQL中使用GRANT和REVOKE语句向用户授予或收回对数据的操作权限。

1.  GRANT(授权)

    -   GRANT语句的一般格式:
        ```sql
        GRANT <权限>[,<权限>]
        ON <对象类型><对象名>[,<对象类型><对象名>]...
        TO <用户>[,用户名]...
        --接受权限的用户，可以为public，代表全体用户
        [WITH GRANT OPTION] --加上此句意为被授权用户具有传播权限
        ```
    -   语义为：将对指定操作对象的指定操作权限授予指定的用户。发出该GRANT语句的可以是数据库管理员、数据库对象的创建者、已经拥有该权限的用户。
    -   eg:
        1.  把查询Student表的权限授给用户U1
            ```sql
            GRANT SELECT
            ON TABLE Student
            To U1;
            ```
        2.  把对Student表和Course表的全部操作权限授予用户U2和U3
            ```sql
            GRANT ALL PRIVILEGES
            ON TABLE Student,Course
            To U2,U3;
            ```
        3.  把对表SC的查询权限授予所有用户
            ```sql
            GRANT SELECT
            ON TABLE SC
            TO PUBLIC;
            ```
        4.  把查询Student表和修改学生学号的权限授给用户U4
            ```sql
            GRANT UPDATE(Sno),SELECT
            ON TABLE Student
            TO U4;
            ```
        5.  把对表SC的INSERT权限授予U5用户，并允许将此权限再授予其他用户
            ```sql
            GRANT INSERT
            ON TABLE SC
            TO U5
            WITH GRANT OPTION;
            ```

2.  REVOKE(收回权限)

    -   语句格式:

        ```sql
        REVOKE <权限>[,<权限>]...
        ON <对象类型><对象名>[,<对象类型><对象名>]
        FROM <用户>[,<用户>]...[CASCADE|RESTRICT];
        ```

    -   eg:
        1.  把用户U4修改学生学号的权限收回
            ```sql
            REVOKE UPDATE(Sno)
            ON TABLE Student
            FROM U4;
            ```
        2.  收回所有用户对表SC的查询权限
            ```sql
            REVOKE SELECT
            ON TABLE SC
            FROM PUBLIC;
            ```
        3.  把用户U5对SC表的INSERT权限收回
            ```sql
            REVOKE INSERT
            ON TABLE SC
            FROM U5 CASCADE;
            --级联CASCADE收回了U5授权给其他用户的INSERT权限
            ```

3.  创建数据库模式的权限

    GRANT和REVOKE语句向用户授予或回收对**数据**的操作权限。对创建数据库模式一类的数据库对象的授权则由数据库管理员在创建用户时实现。

    -   语法格式:
        ```sql
        CREATE USER <username> [WITH][DBA|RESOURCE|CONNECT];
        ```
    -   备注:

        -   只有系统的超级用户才有权创建一个新的数据库用户
        -   新创建的数据库用户有三种权限：DBA、RESOURCE、CONNECT（默认）。
        -   权限与可执行的操作对照表

            !["权限对照表"](img/1.jpg "权限对照表")

### 4.2.5数据库角色

  数据库角色是被命名的一组与数据库操作相关的权限，角色是权限的集合。因此，可以为一组具有相同权限的用户创建一个角色，使用角色来管理数据库权限可以简化授权的过程。

  在SQL中首先用CREATE ROLE语句创建角色,然后用GRANT语句给角色授权，用REVOKE语句收回授予角色的权限。

1.  角色的创建
    ```sql
    CREATE ROLE <角色名>
    ```
2.  给角色授权
    ```sql
    GRANT <权限>[,<权限>]...
    ON <对象类型>对象名
    TO <角色>[,<角色>]...
    ```
3.  将一个角色授予其他的角色或用户
    ```sql
    GRANT <角色1>[,<角色2>]...
    ON <角色3>[,<用户1>]...
    [WITH ADMIN OPTION]--传播权限
    ```
4.  角色权限的收回

    ```sql
    REVOKE <权限>[,<权限>]...
    ON <对象类型><对象名>
    FROM <角色>[,<角色>]...
    ```

5.  eg:

    -   通过角色来实现将一组权限授予一个用户
        ```sql
        -- 1.首先创建一个角色R1
        CREATE ROLE R1;
        --2.然后使用GRANT语句，
        --使角色R1拥有Student表的SELECT、UPDATE、INSERT权限
        GRANT SELECT,UPDATE,INSERT
        ON TABLE Student
        TO R1;
        --3.将这个角色授予U1,U2,U3,
        --使他们拥有角色R1所包含的全部权限
        GRANT R1
        TO U1,U2,U3;
        --4.通过R1收回U1的这三个权限
        REVOKE R1
        FROM U1;
        ```
    -   使角色R1在原来的基础上增加了对Student表的DELETE权限
        ```sql
        GRANT DELETE
        ON TABLE Student
        TO R1;
        ```
    -   使R1减少了SELECT权限
        ```sql
        REVOKE SELECT
        ON TABLE Student
        FROM R1;
        ```

### 4.2.6强制存取控制方法

-   解决的问题：

    自主存取控制(MAC)能够通过授权机制有效的控制对敏感数据的存取。但是由于用户对数据的存取权限是“自主”的，用户可以自由的决定将数据的存取权限授予何人，以及决定是否也将“授权”的的权限授予别人。在这种授权机制下，仍可能存在数据的“无意泄露”。比如:甲将自己的权限范围内的某些数据的存取权限授权给乙，甲的意图是仅允许乙本人操纵这些数据。但甲的这种安全性要求并不能得到保证，因为乙一旦获得了对数据的权限，就可以将数据备份，获得自身权限内的副本并在不征得甲同意的前提下传递。

-   问题产生的原因

    造成这一问题的根本原因就在于：自主存取控制这种机制仅仅通过对数据的存取权限来进行安全控制，而数据本身并无安全性标记。

-   问题解决办法

    要解决这一问题，就要对系统控制下的所有主客体实施强制存取控制策略。

    -   强制存取控制中数据库管理系统的分类
        -   主体：系统中的活动实体，包括数据库管理系统所管理的实际用户、代表用户的各进程。
        -   客体：系统中的被动实体，是受主体操纵的，包括文件、基本表、索引、视图等。
    -   规则：
        1.  仅当主体的许可证级别大于或等于客体的密级时，该主体才能读取相应的客体。
        2.  仅当主体的许可证级别小于或等于客体的密级时，该主体才能写相应的客体。
    -   备注：
        1.  对于主体和客体，数据库管理系统为它们的每个实例（值）指派一个敏感度标记。
        2.  强制存取控制是对数据本身进行密级标记，无论数据如何复制，标记与数据是不可分割的整体，只有符合密级要求的用户才可以操纵数据，从而提供了更高级别的安全性。

* * *

**编辑日期** 2019.5.12

* * *

## 4.3视图机制

-   作用：

    可以为不同的用户定义不同的视图，把数据对象限制在一定的范围内。也就是说，通过视图机制把要保密的数据对无权存取的用户隐藏起来，从而自动对数据提供一定成年度的安全保护。

-   eg：

    -   建立计算机系学生的视图，把对该视图的select权限授予王平，把该视图上的所有操作权限授予张明。
        ```sql
        -- 建立视图
        CREATE VIEW CS_Student
        AS
        SELECT *
        FROM Student
        WHERE Sdept='CS';
        -- 王平只能检索CS_Student的学生信息
        GRANT SELECT
        ON CS_Student
        TO 王平;
        -- 张明有对CS_Student的所有权限
        GRANT ALL PRIVILEGES
        ON CS_Student
        TO 张明;
        ```

## 4.4审计

-   审计功能把用户对数据库的所有操作自动记录下来放入审计日志中。审计员可以利用审计日志监控数据库中的各种行为，重现导致数据库现有状况的一系列事件，找出非法存取数据的人、事件和内容等。

    1.  审计事件分类

    -   服务器事件
    -   系统权限
    -   语句事件
    -   模式对象事件

    2.  审计功能

    -   基本功能
    -   提供多套审计规则
    -   提供审计分析和报表功能
    -   审计日志管理功能
    -   系统提供查询审计设置及审计记录信息的专门视图

    3.  AUDIT 语句和NOAUDIT语句

    -   AUDIT语句用来设置审计功能
    -   NODIT语句用来设置审计功能
    -   审计分类

        -   用户级审计：即任何用户可设置的审计，主要是用户针对自己创建的数据库表或视图进行审计，记录所有用户对这些表或视图的一切成功的访问要求以及各种类型的SQL操作。
        -   系统级审计：即只能由数据库管理员设置，用以检测成功或失败的登陆要求、检测授权和收回操作以及其他数据库级权限下的操作。

    -   eg:
        -   对修改SC表结构或修改SC表数据的操作进行审计。
        ```sql
        AUDIT ALTER,UPDATE
        ON SC;
        ```
        -   取消对SC表的一切审计
        ```sql
        NOAUDIT ALTER,UPDATE
        ON SC;
        ```

-   备注：

    审计设置以及审计日志一般都存储在数据字典中。必须把审计开关打开（即把系统参数audit_trail设置为true），才可以在系统表SYS_AUDITTRAIL中查看到审计信息。

## 4.5数据加密

-   存储加密
-   传输加密

## 4.6其他安全性保护

-   推理控制
-   隐蔽信道
-   数据隐私保护

* * *

**编辑日期** 2019.5.13

* * *
